# Приложение "Сервис рассылок"

## Логика работы программы

- Любой пользователь может зарегистрироваться в сервисе рассылок. Создавать, редактировать и удалять адреса email
  клиентов, тексты писем и расписание их рассылок. При этом пользователь может работать только с сущностями, которые
  создал он. Кроме того, он может просматривать отчеты о тех рассылках, которые отправляли письма созданные только им.


- Любой, даже неавторизованный пользователь, может просматривать статьи в блоге. Создавать, редактировать и удалять
  статьи может только модератор.


- Пользователи из группы managers наделены правами блокировки других пользователей, отключения активных рассылок. Они
  могут просматривать списки всех адресов, сообщений, расписаний рассылки и отчеты о них но не могут их изменять и
  удалять.


- Сервис рассылок позволяет рассылать письма согласно расписанию их рассылок в автоматическом режиме: через определенное
  количество минут, проверяются все расписания рассылок и выбираются те, которые необходимо отправить.

# Инструкция к приложению "Сервис рассылки"

## Начало работы

Прежде чем установить проект, вам неободимо убедиться в том, что у Вас:

```
1. Python версии 3.11 или выше
2. Pip для управления зависимостями
3. Сервер Redis
```

## 1. Установка зависимостей проекта

Активируйте виртуальное окружение с помощью команд:

- Для операционной системы Windows

```commandline
venv/Scripts/activate.bat
```

- Для операционной системы Linux

```commandline
source venv/bin/activate
```

Для установки зависимостей выполните следующую команду:

```commandline
pip install -r requirements.txt
```

## 2. Настройка суперпользователя

Для создания суперпользователя и установки его параметров, отредактируйте файл
`users/management/commands/csu.py`

## 3. Создание суперпользователя

После редактирования для создания суперпользователя в командной строке выполните:

```commandline
python manage.py csu
```

## 4. Инициализация групп

Выполните следующую команду, чтобы создать группы пользователей c назначением им соответствующих прав:

```commandline
python manage.py add_groups
```

## 5. Настройка переменных окружения

Для работы с перменными необходимо будет создать файл `.env` с вашими данными для отправки сообщений и данными для
использования БД. Данные для определения указаны в файле `example.env`.

## 6. Запуск сервера Redis

Сервис использует Redis в качестве БД для кэширования, поэтому убедитесь, что сервер запущен:

- Для операционной системы Windows
  Необходимо установить WSL (Подсистему Windows для Linux), затем запустить Redis в вашем дистрибутиве Linux:

```commandline
sudo service redis-server start
```

- Для Unix-подобных операционных систем

```commandline
sudo service redis-server start
```

## 7. Настройка планировщика задач

Для настройки отправки писем исполььзуется планировщик задач `BackgroundScheduler` из модуля `APScheduler`, настройка
которого производится в файле `wsgi.py`.

```commandline
from django.core.wsgi import get_wsgi_application
from apscheduler.schedulers.background import BackgroundScheduler
from mailing.tasks import send_emails

application = get_wsgi_application()

scheduler = BackgroundScheduler()
scheduler.add_job(send_emails, 'interval', minutes=2)
scheduler.start()
```

В проекте по задача send_mails настроена таким образом, что она будет выпорлняться каждые 2 минуты, чтобы изменить
интервал выполнения задачи поменяйте параметр `minutes=2` на необходимый вам интервал в минутах.

# Запуск проекта

После выполнения всех вышеперечисленных шагов вы можете запустить проект с помощью команды:

```commandline
python manage.py runserver
```